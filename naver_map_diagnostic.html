<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Naver Maps Diagnostic Tool</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #03c75a;
      padding-bottom: 10px;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: #fafafa;
      border-left: 4px solid #03c75a;
    }
    .section h2 {
      margin-top: 0;
      color: #03c75a;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-weight: bold;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    #map {
      width: 100%;
      height: 400px;
      margin-top: 20px;
      border: 2px solid #ddd;
      background: #e0e0e0;
    }
    .code {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      margin: 10px 0;
    }
    .checklist {
      list-style: none;
      padding: 0;
    }
    .checklist li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .checklist li:before {
      content: "âŒ ";
      margin-right: 10px;
    }
    .checklist li.checked:before {
      content: "âœ… ";
    }
    button {
      background: #03c75a;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #02b350;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ—ºï¸ Naver Maps API ì§„ë‹¨ ë„êµ¬</h1>

    <div class="section">
      <h2>ğŸ“‹ ê¸°ë³¸ ì •ë³´</h2>
      <div class="info">
        <strong>Client ID:</strong> rzx12utf2x<br>
        <strong>í˜„ì¬ URL:</strong> <span id="current-url"></span><br>
        <strong>ì‹œê°„:</strong> <span id="current-time"></span>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ” ì§„ë‹¨ ê²°ê³¼</h2>
      <div id="diagnostic-results">
        <div class="warning">ì§„ë‹¨ ì‹œì‘ ì¤‘...</div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“¡ ë„¤íŠ¸ì›Œí¬ ìš”ì²­</h2>
      <div id="network-info">
        <div class="info">ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ—ºï¸ ì§€ë„ í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testMapCreation()">ì§€ë„ ìƒì„± í…ŒìŠ¤íŠ¸</button>
      <button onclick="testGeocoder()">Geocoder í…ŒìŠ¤íŠ¸</button>
      <button onclick="clearMap()">ì§€ë„ ì´ˆê¸°í™”</button>
      <div id="map"></div>
      <div id="map-status" style="margin-top: 10px;"></div>
    </div>

    <div class="section">
      <h2>ğŸ’¡ í•´ê²° ë°©ë²•</h2>
      <div id="solutions"></div>
    </div>

    <div class="section">
      <h2>ğŸ“ ì½˜ì†” ë¡œê·¸</h2>
      <div class="code" id="console-log"></div>
    </div>
  </div>

  <!-- Naver Maps SDK -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=rzx12utf2x&submodules=geocoder"></script>

  <script>
    let map = null;
    let marker = null;
    const logs = [];

    function log(message, type = 'info') {
      const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
      const logEntry = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
      logs.push(logEntry);
      console.log(logEntry);
      updateConsoleLog();
    }

    function updateConsoleLog() {
      document.getElementById('console-log').textContent = logs.join('\n');
    }

    function updateStatus(elementId, html) {
      document.getElementById(elementId).innerHTML = html;
    }

    function runDiagnostics() {
      log('ì§„ë‹¨ ì‹œì‘', 'info');

      const results = [];
      const checks = [];

      // Check 1: SDK ë¡œë“œ í™•ì¸
      log('SDK ë¡œë“œ í™•ì¸', 'check');
      if (window.naver && window.naver.maps) {
        results.push('<div class="success">âœ… Naver Maps SDKê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.</div>');
        checks.push({text: 'SDK ë¡œë“œ', checked: true});
        log('SDK ë¡œë“œ ì„±ê³µ', 'success');
      } else {
        results.push('<div class="error">âŒ Naver Maps SDK ë¡œë“œ ì‹¤íŒ¨<br>ì›ì¸: Client IDê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜, Web ì„œë¹„ìŠ¤ URLì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>');
        checks.push({text: 'SDK ë¡œë“œ', checked: false});
        log('SDK ë¡œë“œ ì‹¤íŒ¨ - API ì¸ì¦ ë¬¸ì œ', 'error');
      }

      // Check 2: naver.maps.Map í™•ì¸
      if (window.naver && window.naver.maps && window.naver.maps.Map) {
        results.push('<div class="success">âœ… naver.maps.Map í´ë˜ìŠ¤ ì‚¬ìš© ê°€ëŠ¥</div>');
        checks.push({text: 'Map í´ë˜ìŠ¤', checked: true});
        log('Map í´ë˜ìŠ¤ ì‚¬ìš© ê°€ëŠ¥', 'success');
      } else {
        results.push('<div class="error">âŒ naver.maps.Map í´ë˜ìŠ¤ ì—†ìŒ</div>');
        checks.push({text: 'Map í´ë˜ìŠ¤', checked: false});
        log('Map í´ë˜ìŠ¤ ì—†ìŒ', 'error');
      }

      // Check 3: Geocoder ì„œë¹„ìŠ¤ í™•ì¸
      if (window.naver && window.naver.maps && window.naver.maps.Service) {
        results.push('<div class="success">âœ… Geocoder ì„œë¹„ìŠ¤ ì‚¬ìš© ê°€ëŠ¥</div>');
        checks.push({text: 'Geocoder ì„œë¹„ìŠ¤', checked: true});
        log('Geocoder ì„œë¹„ìŠ¤ ì‚¬ìš© ê°€ëŠ¥', 'success');
      } else {
        results.push('<div class="warning">âš ï¸ Geocoder ì„œë¹„ìŠ¤ ì—†ìŒ (submodules íŒŒë¼ë¯¸í„° í™•ì¸ í•„ìš”)</div>');
        checks.push({text: 'Geocoder ì„œë¹„ìŠ¤', checked: false});
        log('Geocoder ì„œë¹„ìŠ¤ ì—†ìŒ', 'warning');
      }

      // Check 4: ë„¤íŠ¸ì›Œí¬ ìš”ì²­ (ê°„ì ‘ í™•ì¸)
      if (window.naver && window.naver.maps) {
        results.push('<div class="success">âœ… API ì„œë²„ í†µì‹  ì„±ê³µ (SDKê°€ ë¡œë“œë¨)</div>');
        checks.push({text: 'API ì„œë²„ í†µì‹ ', checked: true});
        log('API ì„œë²„ í†µì‹  ì„±ê³µ', 'success');
      } else {
        results.push('<div class="error">âŒ API ì„œë²„ í†µì‹  ì‹¤íŒ¨<br>ê°€ëŠ¥í•œ ì›ì¸:<br>1. Client ID ì˜¤ë¥˜<br>2. Web ì„œë¹„ìŠ¤ URL ë¯¸ë“±ë¡<br>3. Dynamic Map ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”</div>');
        checks.push({text: 'API ì„œë²„ í†µì‹ ', checked: false});
        log('API ì„œë²„ í†µì‹  ì‹¤íŒ¨', 'error');
      }

      updateStatus('diagnostic-results', results.join(''));

      // í•´ê²° ë°©ë²• í‘œì‹œ
      showSolutions(checks);

      // ë„¤íŠ¸ì›Œí¬ ì •ë³´ ì—…ë°ì´íŠ¸
      updateNetworkInfo();
    }

    function showSolutions(checks) {
      const allPassed = checks.every(check => check.checked);

      if (allPassed) {
        updateStatus('solutions', '<div class="success">ğŸ‰ ëª¨ë“  ì§„ë‹¨ í•­ëª©ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤! ì§€ë„ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>');
        return;
      }

      let solutions = '<ul class="checklist">';

      if (!checks.find(c => c.text === 'SDK ë¡œë“œ')?.checked) {
        solutions += `
          <li><strong>1. ë„¤ì´ë²„ í´ë¼ìš°ë“œ í”Œë«í¼ ì½˜ì†” í™•ì¸</strong></li>
          <li class="checked">ì½˜ì†” ì ‘ì†: <a href="https://console.ncloud.com/maps/application" target="_blank">https://console.ncloud.com/maps/application</a></li>
          <li>Client IDê°€ <code>quSL_7O8Nb5bh6hK4Kj2</code>ì¸ Applicationì„ ì°¾ìœ¼ì„¸ìš”</li>
          <li>Application ìˆ˜ì • í™”ë©´ì—ì„œ:</li>
          <li>&nbsp;&nbsp;- [âœ“] <strong>Dynamic Map</strong> ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì–´ ìˆëŠ”ì§€ í™•ì¸</li>
          <li>&nbsp;&nbsp;- [âœ“] Web ì„œë¹„ìŠ¤ URLì— <code>http://localhost</code> ë“±ë¡ (í¬íŠ¸ ë²ˆí˜¸ ì—†ì´!)</li>
          <li>&nbsp;&nbsp;- [âœ“] Web ì„œë¹„ìŠ¤ URLì— <code>http://127.0.0.1</code> ë“±ë¡</li>
          <li>&nbsp;&nbsp;- ì˜ëª»ëœ í˜•ì‹ (http://localhost:8888) ìˆìœ¼ë©´ ì‚­ì œ</li>
          <li>ì €ì¥ í›„ 5-10ë¶„ ëŒ€ê¸°</li>
          <li>ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ (Shift + Cmd + Delete)</li>
          <li>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (Cmd + R ë˜ëŠ” F5)</li>
        `;
      }

      if (!checks.find(c => c.text === 'Geocoder ì„œë¹„ìŠ¤')?.checked) {
        solutions += `
          <li><strong>2. Geocoding ì„œë¹„ìŠ¤ í™œì„±í™”</strong></li>
          <li>ì½˜ì†”ì—ì„œ Application ìˆ˜ì • í™”ë©´</li>
          <li>[âœ“] <strong>Geocoding</strong> ì²´í¬ë°•ìŠ¤ ì„ íƒ</li>
          <li>ì €ì¥ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
        `;
      }

      solutions += '</ul>';
      updateStatus('solutions', solutions);
    }

    function updateNetworkInfo() {
      const sdkUrl = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=quSL_7O8Nb5bh6hK4Kj2&submodules=geocoder';

      let info = `
        <div class="info">
          <strong>SDK URL:</strong><br>
          <code style="word-break: break-all;">${sdkUrl}</code><br><br>
          <strong>ì°¸ê³ :</strong> ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ (F12) > Network íƒ­ì—ì„œ "validatev3" ìš”ì²­ì„ í™•ì¸í•˜ì„¸ìš”.<br>
          - <strong>Status 200:</strong> ì¸ì¦ ì„±ê³µ âœ…<br>
          - <strong>Status 403:</strong> ì¸ì¦ ì‹¤íŒ¨ (Client ID ë˜ëŠ” URL ë¬¸ì œ) âŒ<br>
          - <strong>Status 404:</strong> Client IDê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ âŒ
        </div>
      `;

      updateStatus('network-info', info);
    }

    function testMapCreation() {
      log('ì§€ë„ ìƒì„± ì‹œë„', 'test');

      if (!window.naver || !window.naver.maps) {
        updateStatus('map-status', '<div class="error">âŒ SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ì§€ë„ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>');
        log('ì§€ë„ ìƒì„± ì‹¤íŒ¨ - SDK ì—†ìŒ', 'error');
        return;
      }

      try {
        map = new naver.maps.Map('map', {
          center: new naver.maps.LatLng(37.5666805, 126.9784147),
          zoom: 15,
          zoomControl: true,
          zoomControlOptions: {
            position: naver.maps.Position.TOP_RIGHT
          }
        });

        marker = new naver.maps.Marker({
          position: new naver.maps.LatLng(37.5666805, 126.9784147),
          map: map,
          title: 'ì„œìš¸ì‹œì²­'
        });

        updateStatus('map-status', '<div class="success">âœ… ì§€ë„ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (ì¤‘ì‹¬: ì„œìš¸ì‹œì²­)</div>');
        log('ì§€ë„ ìƒì„± ì„±ê³µ - ì„œìš¸ì‹œì²­', 'success');

        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        naver.maps.Event.addListener(map, 'click', function(e) {
          log(`ì§€ë„ í´ë¦­: ${e.coord.y.toFixed(6)}, ${e.coord.x.toFixed(6)}`, 'event');
        });

      } catch (error) {
        updateStatus('map-status', `<div class="error">âŒ ì§€ë„ ìƒì„± ì‹¤íŒ¨: ${error.message}</div>`);
        log(`ì§€ë„ ìƒì„± ì˜¤ë¥˜: ${error.message}`, 'error');
      }
    }

    function testGeocoder() {
      log('Geocoder í…ŒìŠ¤íŠ¸ ì‹œì‘', 'test');

      if (!window.naver || !window.naver.maps || !window.naver.maps.Service) {
        updateStatus('map-status', '<div class="error">âŒ Geocoder ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>');
        log('Geocoder í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ - ì„œë¹„ìŠ¤ ì—†ìŒ', 'error');
        return;
      }

      updateStatus('map-status', '<div class="info">ğŸ” Geocoding í…ŒìŠ¤íŠ¸ ì¤‘...</div>');

      naver.maps.Service.geocode({
        query: 'ì„œìš¸ì‹œì²­'
      }, function(status, response) {
        if (status === naver.maps.Service.Status.OK) {
          if (!response.v2 || !response.v2.addresses || response.v2.addresses.length === 0) {
            updateStatus('map-status', '<div class="error">âŒ Geocoding ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤<br>Geocoding APIê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ê±°ë‚˜ Client IDì— ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</div>');
            log('Geocoding ì‘ë‹µ ì—†ìŒ - API ë¹„í™œì„±í™” ë˜ëŠ” ê¶Œí•œ ì—†ìŒ', 'error');
            return;
          }

          const result = response.v2.addresses[0];
          const lat = parseFloat(result.y);
          const lng = parseFloat(result.x);

          updateStatus('map-status', `<div class="success">âœ… Geocoding ì„±ê³µ!<br>ì£¼ì†Œ: ${result.roadAddress}<br>ì¢Œí‘œ: ${lat}, ${lng}</div>`);
          log(`Geocoding ì„±ê³µ: ${result.roadAddress} (${lat}, ${lng})`, 'success');

          if (map) {
            map.setCenter(new naver.maps.LatLng(lat, lng));
            if (marker) marker.setPosition(new naver.maps.LatLng(lat, lng));
          }
        } else {
          updateStatus('map-status', '<div class="error">âŒ Geocoding ì‹¤íŒ¨</div>');
          log('Geocoding ì‹¤íŒ¨', 'error');
        }
      });
    }

    function clearMap() {
      log('ì§€ë„ ì´ˆê¸°í™”', 'action');

      if (marker) {
        marker.setMap(null);
        marker = null;
      }
      if (map) {
        map.destroy();
        map = null;
      }
      document.getElementById('map').innerHTML = '';
      updateStatus('map-status', '<div class="info">ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>');
      log('ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ', 'info');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('load', function() {
      document.getElementById('current-url').textContent = window.location.href;
      document.getElementById('current-time').textContent = new Date().toLocaleString('ko-KR');

      log('ì§„ë‹¨ ë„êµ¬ ì´ˆê¸°í™”', 'info');

      // ì§§ì€ ì§€ì—° í›„ ì§„ë‹¨ ì‹¤í–‰ (SDK ë¡œë”© ëŒ€ê¸°)
      setTimeout(runDiagnostics, 1000);
    });

    // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
    window.addEventListener('error', function(event) {
      log(`ì „ì—­ ì˜¤ë¥˜: ${event.message}`, 'error');
    });
  </script>
</body>
</html>
